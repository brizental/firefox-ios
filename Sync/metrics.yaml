# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
---

$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

sync:
  sync_uuid:
    type: uuid
    description: >
      Unique identifier for this sync, used to correlate together
      individual pings for data types that were synchronized together
      (history, bookmarks, logins).
      If a data type is synchronized by itself via the legacy 'sync' API
      (as opposed to the Sync Manager),
      then this field will not be set on the corresponding ping.
    send_in_pings:
      - temp-sync
      - temp-history-sync
      - temp-bookmarks-sync
      - temp-logins-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/issues/5371
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/5386#pullrequestreview-392363687
    data_sensitivity:
      - technical
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping

# `history-sync`, `logins-sync`, `bookmarks-sync`, `creditcards-sync`,
# `addresses-sync` and `tabs-sync` metrics
# mostly use the same structure, with some minor variability,
# but must be specified individually. We can't define them once and use
# `send_in_pings` because the stores might be synced in parallel, and we can't
# guarantee that a ping for one store would be sent before the others.
history_sync:
  uid:
    type: string
    description: >
      The user's hashed Firefox Account ID.
    send_in_pings:
      - temp-history-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  incoming:
    type: labeled_counter
    labels:
      - applied
      - failed_to_apply
      - reconciled
    description: >
      Records incoming history record counts. `applied` is the number of
      incoming history pages that were successfully stored or updated in the
      local database. `failed_to_apply` is the number of pages that were
      ignored due to errors. `reconciled` is the number of pages with new visits
      locally and remotely, and had their visits merged.
    send_in_pings:
      - temp-history-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  outgoing:
    type: labeled_counter
    labels:
      - uploaded
      - failed_to_upload
    description: >
      Records outgoing history record counts. `uploaded` is the number of
      records that were successfully sent to the server. `failed_to_upload`
      is the number of records that weren't uploaded, and will be retried
      on the next sync.
    send_in_pings:
      - temp-history-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping

logins_sync:
  uid:
    type: string
    description: >
      The user's hashed Firefox Account ID.
    send_in_pings:
      - temp-logins-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/issues/4556
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/5294
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  incoming:
    type: labeled_counter
    labels:
      - applied
      - failed_to_apply
      - reconciled
    description: >
      Records incoming passwords record counts. `applied` is the number of
      incoming passwords entries that were successfully stored or updated in the
      local database. `failed_to_apply` is the number of entries that were
      ignored due to errors. `reconciled` is the number of entries with changes
      both locally and remotely that were merged.
    send_in_pings:
      - temp-logins-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/issues/4556
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/5294
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  outgoing:
    type: labeled_counter
    labels:
      - uploaded
      - failed_to_upload
    description: >
      Records outgoing passwords record counts. `uploaded` is the number of
      records that were successfully sent to the server. `failed_to_upload`
      is the number of records that weren't uploaded, and will be retried
      on the next sync.
    send_in_pings:
      - temp-logins-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/issues/4556
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/5294
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping

bookmarks_sync:
  uid:
    type: string
    description: >
      The user's hashed Firefox Account ID.
    send_in_pings:
      - temp-bookmarks-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  incoming:
    type: labeled_counter
    labels:
      - applied
      - failed_to_apply
      - reconciled
    description: >
      Records incoming bookmark record counts.
    send_in_pings:
      - temp-bookmarks-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  outgoing:
    type: labeled_counter
    labels:
      - uploaded
      - failed_to_upload
    description: >
      Records outgoing bookmark record counts.
    send_in_pings:
      - temp-bookmarks-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/3092
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping

tabs_sync:
  uid:
    type: string
    description: >
      The user's hashed Firefox Account ID.
    send_in_pings:
      - temp-tabs-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/issues/10371
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/10372#issuecomment-850378481
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  incoming:
    type: labeled_counter
    labels:
      - applied
      - failed_to_apply
      - reconciled
    description: >
      Records incoming tabs record counts. `applied` is the number of
      incoming records that were successfully stored or updated in the
      local database. `failed_to_apply` is the number of records that were
      ignored due to errors. `reconciled` is the number of merged records.
    send_in_pings:
      - temp-tabs-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/issues/10371
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/10372#issuecomment-850378481
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
  outgoing:
    type: labeled_counter
    labels:
      - uploaded
      - failed_to_upload
    description: >
      Records outgoing tabs record counts. `uploaded` is the number of
      records that were successfully sent to the server. `failed_to_upload`
      is the number of records that weren't uploaded, and will be retried
      on the next sync.
    send_in_pings:
      - temp-tabs-sync
    bugs:
      - https://github.com/mozilla-mobile/android-components/issues/10371
    data_reviews:
      - https://github.com/mozilla-mobile/android-components/pull/10372#issuecomment-850378481
    data_sensitivity:
      - interaction
    notification_emails:
      - sync-core@mozilla.com
    expires: never
    lifetime: ping
